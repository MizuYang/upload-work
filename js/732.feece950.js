"use strict";(self["webpackChunkvue_template"]=self["webpackChunkvue_template"]||[]).push([[732],{1732:function(e,t,i){i.r(t),i.d(t,{default:function(){return We}});var o=i(3396);const r={class:"my-3"},s=(0,o._)("h2",null,"上傳 + 驗證",-1),l=(0,o._)("hr",null,null,-1),n={class:"my-3"},a=(0,o._)("h2",null,[(0,o.Uk)("測試：props 參數,"),(0,o._)("code",null,"size:165800"),(0,o.Uk)(" (B), "),(0,o._)("code",null,"w:150"),(0,o.Uk)(", "),(0,o._)("code",null,"h:150")],-1),p=(0,o._)("hr",null,null,-1),c={class:"my-3"},h=(0,o._)("h2",null,"測試裁切",-1);function u(e,t,i,u,g,d){const m=(0,o.up)("UploadImg");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("section",r,[s,(0,o.Wm)(m,{size:g.size,type:g.type,width:g.width,height:g.height,onUpload:d.upload},null,8,["size","type","width","height","onUpload"])]),l,(0,o._)("section",n,[a,(0,o.Wm)(m,{size:165800,type:g.type,width:150,height:150,onUpload:d.upload},null,8,["type","onUpload"])]),p,(0,o._)("section",c,[h,(0,o.Wm)(m,{size:1658e3,type:g.type,width:1500,height:1500,onUpload:d.upload},null,8,["type","onUpload"])])],64)}const g=(0,o._)("label",{for:"file"},null,-1),d=["accept"],m={key:0,class:"my-2"},f={class:"my-3"},w={ref:"uploadResult"},y={key:1,class:"my-3"},v={key:2,class:"my-5"},U={key:3,class:"my-5"},b={class:"my-3"},S={class:"my-5"},C={key:4,class:"my-5"};function k(e,t,i,r,s,l){const n=(0,o.up)("ProgressBar"),a=(0,o.up)("PerviewImg"),p=(0,o.up)("CropSize"),c=(0,o.up)("CropImg"),h=(0,o.up)("SimpleUploader");return(0,o.wg)(),(0,o.iD)(o.HY,null,[g,(0,o._)("input",{type:"file",id:"file",name:"file",onChange:t[0]||(t[0]=(...e)=>l.getFileInfo&&l.getFileInfo(...e)),accept:s.accept},null,40,d),l.uploadSuccess?((0,o.wg)(),(0,o.iD)("div",m,[(0,o.Wm)(n,{ref:"progressBar"},null,512)])):(0,o.kq)("",!0),(0,o._)("div",f,[(0,o._)("p",w,null,512)]),l.uploadSuccess?((0,o.wg)(),(0,o.iD)("div",y,[(0,o.Wm)(a,{imgUrl:s.file.perviewImgUrl,ref:"preview"},null,8,["imgUrl"])])):(0,o.kq)("",!0),l.uploadSuccess?((0,o.wg)(),(0,o.iD)("div",v,[(0,o.Wm)(p,{onGetCropSize:l.getCropSize,onGetCropMode:l.getCropMode},null,8,["onGetCropSize","onGetCropMode"])])):(0,o.kq)("",!0),l.uploadSuccess?((0,o.wg)(),(0,o.iD)("div",U,[(0,o._)("div",b,[(0,o.Wm)(c,{imgUrl:s.file.perviewImgUrl,cropW:s.cropSize.width,cropH:s.cropSize.height,fixedSize:s.fixedSize,onGetCropUrl:l.getCropUrl,onGetOriginUrl:l.getOriginUrl},null,8,["imgUrl","cropW","cropH","fixedSize","onGetCropUrl","onGetOriginUrl"])])])):(0,o.kq)("",!0),(0,o._)("div",S,[(0,o.Wm)(h,{ref:"uploaderRef",onUploaderSuccess:e.uploaderSuccess},null,8,["onUploaderSuccess"])]),l.uploadSuccess?((0,o.wg)(),(0,o.iD)("div",C,[(0,o._)("button",{class:"btn btn-primary",type:"button",onClick:t[1]||(t[1]=t=>e.$emit("upload",s.file))},"確認上傳")])):(0,o.kq)("",!0)],64)}i(6699);const x={ref:"progress",value:"0",max:"100"},z={ref:"progressLabel",for:"progress"};function _(e,t){return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("progress",x,null,512),(0,o._)("label",z,null,512)],64)}var $=i(89);const I={},F=(0,$.Z)(I,[["render",_]]);var D=F,M=i(9242);const R=["value"],T={class:"my-3"},W=(0,o._)("h3",null,"檔案預覽",-1),B=["src"];function H(e,t,i,r,s,l){return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("input",{type:"button",onClick:t[0]||(t[0]=e=>s.previewShow=!s.previewShow),value:s.previewShow?"關閉圖片預覽":"開啟圖片預覽",class:"btn btn-primary"},null,8,R),(0,o.wy)((0,o._)("section",T,[W,(0,o._)("img",{src:i.imgUrl,alt:"上傳的圖片預覽",ref:"previewImg"},null,8,B)],512),[[M.F8,s.previewShow&&i.imgUrl]])],64)}var L={props:{imgUrl:{type:String}},data(){return{previewShow:!1}}};const P=(0,$.Z)(L,[["render",H]]);var N=P;const j=["value"],O={key:0,class:"row height my-3"},q={class:"col-5"},G=(0,o._)("h4",null,"裁切前",-1),V={class:"col-2 my-auto"},A={class:"my-2"},Y={class:"my-2"},Z={class:"col-5 m-auto"},E=(0,o._)("h4",null,"裁切後",-1),J=["src"];function K(e,t,i,r,s,l){const n=(0,o.up)("VueCropper");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("input",{type:"button",onClick:t[0]||(t[0]=e=>s.cropShow=!s.cropShow),value:s.cropShow?"關閉裁切":"開啟裁切",class:"btn btn-primary"},null,8,j),s.cropShow?((0,o.wg)(),(0,o.iD)("div",O,[(0,o._)("div",q,[G,(0,o.Wm)(n,{ref:"cropper",img:i.imgUrl,outputSize:s.option.size,outputType:s.option.outputType,info:!0,full:s.option.full,fixed:s.option.fixed,fixedNumber:s.option.fixedNumber,"can-move":s.option.canMove,"can-move-box":s.option.canMoveBox,"fixed-box":s.option.fixedBox,original:s.option.original,"auto-crop":s.option.autoCrop,"auto-crop-width":s.option.autoCropWidth,"auto-crop-height":s.option.autoCropHeight,"center-box":s.option.centerBox,high:s.option.high,mode:"contain","max-img-size":s.option.max,onCropMoving:e.cropMoving,onImgLoad:e.imgLoad,onRealTime:e.realTime},null,8,["img","outputSize","outputType","full","fixed","fixedNumber","can-move","can-move-box","fixed-box","original","auto-crop","auto-crop-width","auto-crop-height","center-box","high","max-img-size","onCropMoving","onImgLoad","onRealTime"])]),(0,o._)("div",V,[(0,o._)("button",{class:"btn btn-primary",type:"button",onClick:t[1]||(t[1]=(...e)=>l.getCropImgUrl&&l.getCropImgUrl(...e))},"裁切"),(0,o._)("div",A,[s.cropImgUrl?((0,o.wg)(),(0,o.iD)("button",{key:0,class:"btn btn-primary",type:"button",onClick:t[2]||(t[2]=(...e)=>l.getCropUrl&&l.getCropUrl(...e)),ref:"confirmBtn"},"確認裁切",512)):(0,o.kq)("",!0)]),(0,o._)("div",Y,[(0,o._)("button",{class:"btn btn-primary btn-secondary d-none",type:"button",onClick:t[3]||(t[3]=(...e)=>l.getOriginUrl&&l.getOriginUrl(...e)),ref:"originBtn"},"恢復裁切",512)])]),(0,o._)("div",Z,[E,s.cropImgUrl?((0,o.wg)(),(0,o.iD)("img",{key:0,src:s.cropImgUrl,alt:"裁切後的圖片"},null,8,J)):(0,o.kq)("",!0)])])):(0,o.kq)("",!0)],64)}var Q=i(5276),X={components:{VueCropper:Q.AK},props:{imgUrl:{type:String},cropW:{type:Number,default:160},cropH:{type:Number,default:150},fixedSize:{type:Boolean,default:!1}},emits:["getCropUrl","getOriginUrl"],watch:{cropW(){this.option.autoCropWidth=this.cropW},cropH(){this.option.autoCropHeight=this.cropH},fixedSize(){this.option.fixedBox=this.fixedSize}},data(){return{option:{size:1,full:!1,outputType:"jpg",canMove:!1,fixedBox:this.fixedSize,original:!1,canMoveBox:!0,autoCrop:!0,autoCropWidth:this.cropW,autoCropHeight:this.cropH,centerBox:!0,high:!0,max:99999,fixed:!1},cropImgUrl:"",cropShow:!1}},methods:{getCropImgUrl(){this.$nextTick((()=>{this.$refs.cropper.getCropData((e=>{this.cropImgUrl=e}))}))},getCropUrl(){this.$refs.originBtn.classList.remove("d-none"),this.$emit("getCropUrl",this.cropImgUrl)},getOriginUrl(){this.$refs.originBtn.classList.add("d-none"),this.$emit("getOriginUrl")}},mounted(){this.originUrl=this.imgUrl}};const ee=(0,$.Z)(X,[["render",K]]);var te=ee;const ie=(0,o._)("h3",null,"裁切模式",-1),oe=(0,o._)("option",{value:"自由裁切"},"自由裁切",-1),re=(0,o._)("option",{value:"限制裁切寬高"},"限制裁切寬高",-1),se=[oe,re],le={key:0,class:"my-3"},ne=(0,o._)("p",{class:"fs-5"},"輸入希望裁切的圖片尺寸",-1),ae=(0,o._)("label",{for:"width"},"寬：",-1),pe=(0,o._)("br",null,null,-1),ce=(0,o._)("label",{for:"height"},"高：",-1);function he(e,t,i,r,s,l){return(0,o.wg)(),(0,o.iD)(o.HY,null,[ie,(0,o.wy)((0,o._)("select",{name:"",id:"","onUpdate:modelValue":t[0]||(t[0]=e=>s.cropType=e)},se,512),[[M.bM,s.cropType]]),"限制裁切寬高"===s.cropType?((0,o.wg)(),(0,o.iD)("div",le,[ne,ae,(0,o.wy)((0,o._)("input",{id:"width",type:"number","onUpdate:modelValue":t[1]||(t[1]=e=>s.crop.width=e),placeholder:"輸入裁切寬度",style:{width:"120px"},oninput:"value=value.replace(/[^\\d]/g,'')"},null,512),[[M.nr,s.crop.width]]),pe,ce,(0,o.wy)((0,o._)("input",{id:"height",type:"number","onUpdate:modelValue":t[2]||(t[2]=e=>s.crop.height=e),placeholder:"輸入裁切高度",style:{width:"120px"},oninput:"value=value.replace(/[^\\d]/g,'')"},null,512),[[M.nr,s.crop.height]])])):(0,o.kq)("",!0)],64)}var ue={emits:["getCropSize","getCropMode"],watch:{crop:{handler(){this.$emit("getCropSize",this.crop)},deep:!0},cropType(){this.$emit("getCropMode",this.cropType)}},data(){return{crop:{width:160,height:150},cropType:"自由裁切"}}};const ge=(0,$.Z)(ue,[["render",he]]);var de=ge,me=i(3157),fe=i.n(me);const we=(0,o._)("p",null,"將文件拖放到此處以上傳",-1),ye=(0,o.Uk)("選擇檔案"),ve=(0,o.Uk)("選擇圖片"),Ue=(0,o.Uk)("選擇資料夾"),be={key:0,class:"row row-cols-3 g-3 list-unstyled my-3"},Se=["src"],Ce={class:"my-3"};function ke(e,t,i,r,s,l){const n=(0,o.up)("uploader-unsupport"),a=(0,o.up)("uploader-btn"),p=(0,o.up)("uploader-drop"),c=(0,o.up)("uploader-list"),h=(0,o.up)("uploader"),u=(0,o.up)("CropImg");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(h,{options:s.options,class:"uploader-example",autoStart:!0,ref:"uploader",onFileAdded:l.onFileAdded,onFileSuccess:l.onFileSuccess,onFileProgress:l.onFileProgress,onFileError:l.onFileError},{default:(0,o.w5)((()=>[(0,o.Wm)(n),(0,o.Wm)(p,null,{default:(0,o.w5)((()=>[we,(0,o.Wm)(a,null,{default:(0,o.w5)((()=>[ye])),_:1}),(0,o.Wm)(a,{attrs:s.attrs,ref:"img"},{default:(0,o.w5)((()=>[ve])),_:1},8,["attrs"]),(0,o.Wm)(a,{directory:!0},{default:(0,o.w5)((()=>[Ue])),_:1})])),_:1}),(0,o.Wm)(c)])),_:1},8,["options","onFileAdded","onFileSuccess","onFileProgress","onFileError"]),l.previewImg.length>0?((0,o.wg)(),(0,o.iD)("ul",be,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(l.previewImg,(e=>((0,o.wg)(),(0,o.iD)("li",{key:e},[(0,o._)("img",{src:e,alt:"",width:"200",height:"200"},null,8,Se),(0,o._)("div",Ce,[(0,o.Wm)(u,{imgUrl:e,cropW:150,cropH:160,fixedSize:!1,onGetCropUrl:l.getCropUrl,onGetOriginUrl:l.getOriginUrl},null,8,["imgUrl","onGetCropUrl","onGetOriginUrl"])])])))),128))])):(0,o.kq)("",!0)],64)}var xe=i(7335),ze=i.n(xe),_e={components:{CropImg:te},computed:{previewImg(){const e=[];return 0===this.file.length||this.file.forEach((t=>{const i=t.name.split(".").pop();if(this.imgType.includes(i)){if(t.heic)return console.log(t.url),void e.push(t.url);const i=URL.createObjectURL(t.file);e.push(i)}})),e}},data(){return{file:[],uploader:null,options:{target:"/",testChunks:!0,chunkSize:"2048000",maxChunkRetries:3},attrs:{accept:"image/*"},statusText:{success:"成功了",error:"出錯了",uploading:"上傳中",paused:"暫停中",waiting:"等待中"},imgType:["png","jpg","svg","jpeg","bmp","gif","heic","heif"],size:153600}},
//! 元件化
//! 完成其他需求，例：圖片裁切
//! 確認裁切、恢復裁切
//! 按確認上傳後取得 file 物件
methods:{async onFileAdded(e){const t=e.name.split(".").pop();if(!this.imgType.includes(t)){const i=`請上傳正確的圖片格式！您上傳的是${t}檔`;throw e.cancel(),i}const i=e.size;if(i>this.size){const t=`請上傳低於 ${this.size/1024} Kb 的圖片`;throw e.cancel(),t}console.log(1),"heic"===t||"heif"===t?await this.heic2Jpeg(e.file).then((t=>{console.log(2);const i=new Image;i.src=t,i.onload=()=>{if(i.width>this.width||i.height>this.height){e.cancel();const t=`請上傳 ${this.width}*${this.height} 的圖片，您上傳的是${i.width}*${i.height}`;throw t}}})):await this.getImgSize(e).then((t=>{if(console.log(2),t.width>this.width||t.height>this.height){const i=`請上傳 ${this.width}*${this.height} 的圖片，您上傳的是${t.width}*${t.height}`;throw e.cancel(),i}})),console.log(3),this.panelShow=!0,this.computeMD5(e),e.params=this.params},getImgSize(e){return new Promise(((t,i)=>{const o=URL.createObjectURL(e.file),r=new Image;r.src=o,r.onload=function(){const e={};e.height=r.naturalWidth,e.width=r.naturalHeight,t(e)}}))},getRandomFileName(){let e="";const t=30,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let o=0;o<t;o++)e+=i.charAt(Math.floor(Math.random()*i.length));return e},heic2Jpeg(e){return new Promise(((t,i)=>{console.log(e);const o=e.name;fe()({blob:e,toType:"image/jpeg",quality:1}).then((e=>{const i=URL.createObjectURL(e);console.log("heicToJpgResult",e),this.file.push(e);const r=this.file.length;this.file[r-1].newFileName=this.getRandomFileName(),this.file[r-1].url=i,this.file[r-1].name=o,this.file[r-1].heic=!0,t(i)}))}))},onFileProgress(e,t,i){console.log(`上传中 ${t.name}，chunk：${i.startByte/1024/1024} ~ ${i.endByte/1024/1024}`)},onFileSuccess(e,t,i,o){const r="heic";if(!t.name.includes(r)&&!t.aborted){this.file.push(t);const e=this.file.length;this.file[e-1].newFileName=this.getRandomFileName()}},onFileError(e,t,i,o){this.$message({message:i,type:"error"})},computeMD5(e){const t=new FileReader,i=(new Date).getTime(),o=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice;let r=0;const s=1024e4,l=Math.ceil(e.size/s),n=new(ze().ArrayBuffer);function a(){const i=r*s,l=i+s>=e.size?e.size:i+s;t.readAsArrayBuffer(o.call(e.file,i,l))}this.statusSet(e.id,"md5"),e.pause(),a(),t.onload=t=>{if(n.append(t.target.result),r<l)r++,a();else{const t=n.end();this.computeMD5Success(t,e),console.log(`MD5计算完毕：${e.name} \nMD5：${t} \n分片：${l} 大小:${e.size} 用时：${(new Date).getTime()-i} ms`)}},t.onerror=function(){this.error(`文件${e.name}读取出错，请检查该文件`),e.cancel()}},computeMD5Success(e,t){t.uniqueIdentifier=e,t.resume(),this.statusRemove(t.id)},fileListShow(){},close(){this.uploader.cancel(),this.panelShow=!1},statusSet(e,t){const i={md5:{text:"校验MD5",bgc:"#fff"},merging:{text:"合并中",bgc:"#e2eeff"},transcoding:{text:"转码中",bgc:"#e2eeff"},failed:{text:"上传失败",bgc:"#e2eeff"}};console.log(i),console.log("id:",e),console.log("status:",t)},statusRemove(e){},error(e){this.$notify({title:"错误",message:e,type:"error",duration:2e3})},getCropUrl(e,t){console.log(this.file[0]),this.file[0].url=e},getOriginUrl(){this.file.perviewImgUrl=this.tempPreviewImgUrl}},mounted(){this.$nextTick((()=>{})),setInterval((()=>{}),2500)}};const $e=(0,$.Z)(_e,[["render",ke]]);var Ie=$e,Fe={components:{ProgressBar:D,PerviewImg:N,CropImg:te,CropSize:de,SimpleUploader:Ie},props:{size:{type:Number,default:31457280},type:{type:Array,default:["png","jpg","svg","jpeg","bmp","gif"]},width:{type:Number,default:500},height:{type:Number,default:500}},emits:["upload"],computed:{uploadSuccess(){return this.status===this.uploadStatus.success}},data(){return{file:{},reader:"",imgType:["png","jpg","svg","jpeg","bmp","gif","heic","heif"],status:0,uploadStatus:{null:0,success:1,fail:2},accept:".jpg, .png, .svg, .gif, .jpeg",resolutionValidate:!1,cropSize:{},fixedSize:!1,tempPreviewImgUrl:""}},methods:{getFileInfo(e){if(!e)return;const t=e.target.files[0],i=t.name.split(".").pop(),o=t.size,r=this.checkType(i,t);if(!r)return;this.imgType.includes(i)&&(this.checkResolution(t).then((e=>{console.log(e)})),"heic"!==i&&"heif"!==i||this.checkHeicResolution());const s=this.checkSize(o);if(!s)return;"heic"!==i&&"heif"!==i||this.heic2Jpeg(t),this.successFeedback(e),this.getProgressBar();const l=t.name.split(".")[0],n=t.lastModifiedDate.toLocaleString(),a=(new Date).toLocaleString(),p=this.getNewFileName(),c=this.getPreviewImgUrl(e);this.file={uploadDate:a,name:l,newFileName:p,size:o,type:i,lastModifiedDate:n,perviewImgUrl:c,file:t},console.log(this.file)},getProgressBar(){this.reader.addEventListener("progress",(e=>{if(e.loaded&&e.total){const t=e.loaded/e.total*100,i=this.$refs.progressBar?.$refs.progress,o=this.$refs.progressBar?.$refs.progressLabel;i&&o&&(i.value=t,o.innerHTML=Math.round(t)+"%")}}))},getNewFileName(){const e=`${Math.random()}${Math.random()}`,t=e.split(".");t.shift();const i=t.join("").slice(0,30);return i},getCropSize(e){this.cropSize.width=e.width,this.cropSize.height=e.height},getCropMode(e){"自由裁切"===e?this.fixedSize=!1:"限制裁切寬高"===e&&(this.fixedSize=!0)},getPreviewImgUrl(e){const t=e.target.files[0],i=URL.createObjectURL(t);return this.tempPreviewImgUrl=i,i},getCropUrl(e){this.file.perviewImgUrl=e},getOriginUrl(){this.file.perviewImgUrl=this.tempPreviewImgUrl},clearPreviewImgUrl(){this.file.perviewImgUrl=""},heic2Jpeg(e){fe()({blob:e,toType:"image/jpeg",quality:1}).then((e=>{this.file.perviewImgUrl=URL.createObjectURL(e)}))},checkResolution(e){return new Promise(((t,i)=>{this.resolutionValidate=!1,this.reader.onload=e=>{const i=e.target.result,o=new Image;o.onload=()=>{const e=o.width,i=o.height,r=e<this.width&&i<this.height;r?r&&(this.resolutionValidate=!0,t(!0)):(this.failFeedback(`圖片寬高須低於${this.width}*${this.height}！`),this.resolutionValidate=!1,t(!1))},this.resolutionValidate||(o.src=i)},this.reader.readAsDataURL(e)}))},checkHeicResolution(){setTimeout((()=>{const e=this.$refs.preview.$refs.previewImg.naturalWidth,t=this.$refs.preview.$refs.previewImg.naturalHeight,i=e<this.width&&t<this.height;i?i&&(this.resolutionValidate=!0):(this.failFeedback(`圖片寬高須低於${this.width}*${this.height}！`),this.resolutionValidate=!1)}),500)},checkType(e,t){const i=this.type.includes(e);return i?!!i||void 0:(this.failFeedback(`請上傳 ${this.type} 的檔案，您上傳的是 ${e}檔`),!1)},checkSize(e){const t=e<this.size;if(!t){const t=(this.size/1024/1024).toFixed(1),i=(e/1024/1024).toFixed(1);return this.failFeedback(`檔案大小不得高於 ${t}MB！您的檔案大小為 ${i} MB`),!1}if(t)return!0},failFeedback(e){this.status=this.uploadStatus.fail,this.clearPreviewImgUrl(),this.$refs.uploadResult.textContent=e,this.$refs.uploadResult.className="fail text-danger fst-italic"},successFeedback(e){this.status=this.uploadStatus.success,this.$refs.uploadResult.textContent="上傳成功！",this.$refs.uploadResult.className="success text-success"}},mounted(){this.reader=new FileReader}};const De=(0,$.Z)(Fe,[["render",k]]);var Me=De,Re={components:{UploadImg:Me},data(){return{size:31457280,type:["png","jpg","svg","jpeg","bmp","gif","heic","heif"],width:400,height:400,file:{}}},methods:{upload(e){console.log(e)}}};const Te=(0,$.Z)(Re,[["render",u]]);var We=Te}}]);
//# sourceMappingURL=732.feece950.js.map